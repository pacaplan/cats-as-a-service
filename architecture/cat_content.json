{
  "$schema": "rampart/schema/bounded_context_v1.json",
  "name": "Cat & Content",
  "profile": "rampart_hexddd_v1",
  "description": "Premade cat catalog (Cat-alog), user-generated custom cats (AI), and AI-generated copy & media",

  "actors": [
    {
      "name": "Shopper",
      "description": "Browses catalog, creates custom cats (guest or registered)"
    },
    {
      "name": "Admin",
      "description": "Manages premade catalog, moderates custom cats"
    }
  ],

  "relationships": {
    "publishes_to": [
      {
        "bc": "commerce",
        "via": "events",
        "events": ["CatListingPublished", "CatListingArchived", "CustomCatCreated"]
      }
    ],
    "consumed_by": [
      {
        "bc": "commerce",
        "purpose": "reads cat data for cart/checkout"
      }
    ]
  },

  "layers": {
    "domain": {
      "aggregates": [
        {
          "name": "CatListing",
          "description": "Premade, curated, globally visible cat in the Cat-alog; root for catalog browsing",
          "entity": "CatProfile",
          "key_attributes": ["id", "name", "description", "image_url", "base_price"],
          "invariants": [
            "must have name",
            "must have description",
            "base_price must be positive"
          ],
          "lifecycle": ["draft", "published", "archived"]
        },
        {
          "name": "CustomCat",
          "description": "User-specific, AI-generated cat record; root for user's created cats",
          "key_attributes": ["id", "name", "description", "image_url", "creator_user_id"],
          "invariants": [
            "must have creator_user_id",
            "must have name"
          ],
          "lifecycle": ["generating", "active", "archived"]
        }
      ],
      "events": [
        {
          "name": "CatListingPublished",
          "description": "Emitted when a premade cat becomes publicly visible",
          "payload_intent": ["listing_id", "name", "base_price", "published_at"]
        },
        {
          "name": "CatListingArchived",
          "description": "Emitted when a premade cat is removed from public view",
          "payload_intent": ["listing_id", "archived_at"]
        },
        {
          "name": "CustomCatCreated",
          "description": "Emitted when a user's custom cat is successfully generated",
          "payload_intent": ["custom_cat_id", "creator_user_id", "name", "created_at"]
        },
        {
          "name": "CustomCatArchived",
          "description": "Emitted when a user archives their custom cat",
          "payload_intent": ["custom_cat_id", "archived_at", "archived_by"]
        },
        {
          "name": "CatDescriptionRegenerated",
          "description": "Emitted when AI regenerates a cat's description",
          "payload_intent": ["cat_id", "cat_type", "regenerated_at"]
        }
      ],
      "ports": {
        "repositories": [
          "CatListingRepository",
          "CustomCatRepository"
        ],
        "external": [
          {
            "name": "LanguageModelPort",
            "description": "Interface for LLM text generation"
          },
          {
            "name": "ClockPort",
            "description": "Interface for current time (testability)"
          },
          {
            "name": "IdGeneratorPort",
            "description": "Interface for unique ID generation"
          },
          {
            "name": "TransactionPort",
            "description": "Interface for database transaction management"
          }
        ]
      }
    },

    "application": {
      "services": [
        {
          "name": "CatListingService",
          "orchestrates": "CatListing"
        },
        {
          "name": "CustomCatService",
          "orchestrates": "CustomCat"
        }
      ],
      "capabilities": [
        {
          "name": "BrowseCatalog",
          "actors": ["Shopper", "Guest"],
          "entrypoints": ["CatListingsController#index", "CatListingsController#show"],
          "orchestrates": ["CatListingService"],
          "uses_ports": ["CatListingRepository"],
          "emits": [],
          "outputs": ["CatListing"]
        },
        {
          "name": "GenerateCustomCat",
          "actors": ["Shopper"],
          "entrypoints": ["CustomCatsController#generate"],
          "orchestrates": ["CustomCatService"],
          "uses_ports": ["LanguageModelPort", "CustomCatRepository"],
          "emits": ["CustomCatCreated"],
          "outputs": ["CustomCat"]
        },
        {
          "name": "ManageCatalog",
          "actors": ["Admin"],
          "entrypoints": ["CatListingsController#create", "CatListingsController#update", "CatListingsController#publish", "CatListingsController#archive"],
          "orchestrates": ["CatListingService"],
          "uses_ports": ["CatListingRepository"],
          "emits": ["CatListingPublished", "CatListingArchived"],
          "outputs": ["CatListing"]
        },
        {
          "name": "ModerateCustomCats",
          "actors": ["Admin"],
          "entrypoints": ["CustomCatsController#index", "CustomCatsController#archive"],
          "orchestrates": ["CustomCatService"],
          "uses_ports": ["CustomCatRepository"],
          "emits": ["CustomCatArchived"],
          "outputs": []
        }
      ]
    },

    "infrastructure": {
      "adapters": {
        "persistence": [
          {
            "name": "SqlCatListingRepository",
            "implements": "CatListingRepository"
          },
          {
            "name": "SqlCustomCatRepository",
            "implements": "CustomCatRepository"
          }
        ],
        "external": [
          {
            "name": "OpenAIApiLanguageModelAdapter",
            "implements": "LanguageModelPort"
          },
          {
            "name": "ClaudeApiLanguageModelAdapter",
            "implements": "LanguageModelPort"
          },
          {
            "name": "SystemClockAdapter",
            "implements": "ClockPort"
          },
          {
            "name": "UuidIdGeneratorAdapter",
            "implements": "IdGeneratorPort"
          },
          {
            "name": "DatabaseTransactionAdapter",
            "implements": "TransactionPort"
          }
        ]
      },
      "entrypoints": {
        "http": [
          {
            "name": "CatListingsController",
            "routes": "/catalog"
          },
          {
            "name": "CustomCatsController",
            "routes": "/custom-cats"
          }
        ]
      },
      "wiring": "Dry::Container"
    }
  },

  "external_systems": [
    {
      "name": "Language Models",
      "providers": ["OpenAI", "Claude"],
      "description": "AI text generation for cat names, stories, descriptions"
    },
    {
      "name": "Event Bus",
      "description": "Domain event publishing to other bounded contexts"
    },
    {
      "name": "PostgreSQL",
      "description": "Persistence for aggregates"
    }
  ]
}
